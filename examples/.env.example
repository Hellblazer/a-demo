# Sky Application Environment Variables Template
# Copy this file to .env and customize for your deployment
# Usage: docker run --env-file .env com.hellblazer.sky/sky-image:0.0.1-SNAPSHOT

# ==============================================================================
# BOOTSTRAP AND MEMBERSHIP
# ==============================================================================

# GENESIS - Indicates this node participates in Genesis block generation
# Set to 'true' for all kernel members (minimum 4 nodes for BFT)
# Set to 'false' or omit for nodes joining after cluster formation
# Default: false
GENESIS='true'

# APPROACHES - Comma-separated list of APPROACH endpoints for discovery
# Format: host1:port1,host2:port2,...
# Used by joining nodes to discover existing cluster
# Example: 172.17.0.2:50001,172.17.0.3:50001
# Default: (none - joins via SEEDS only)
APPROACHES='172.17.0.2:50001'

# SEEDS - Comma-separated list of CLUSTER endpoints with API ports
# Format: host1:cluster_port1#api_port1,host2:cluster_port2#api_port2,...
# Used for cluster membership discovery
# Example: 172.17.0.2:50002#50000
# Default: (none - required for non-Genesis nodes)
SEEDS='172.17.0.2:50002#50000'

# ==============================================================================
# NETWORK CONFIGURATION
# ==============================================================================

# BIND_INTERFACE - Network interface to bind services
# Common values: eth0 (Docker default), en0 (macOS), wlan0 (WiFi)
# Use 'ip addr' or 'ifconfig' to list available interfaces
# **REQUIRED**
BIND_INTERFACE='eth0'

# HOST_ADDRESS - Explicit host address (overrides auto-detection)
# Use when BIND_INTERFACE auto-detection fails or for specific IP
# Format: IPv4 address (e.g., 192.168.1.100)
# Default: (auto-detected from BIND_INTERFACE)
# HOST_ADDRESS='192.168.1.100'

# ==============================================================================
# SERVICE PORTS
# ==============================================================================

# API - Oracle API gRPC port
# Used by clients to interact with the Oracle (ReBAC engine)
# Default: 50000
API=50000

# APPROACH - Fireflies membership APPROACH port
# Used by new nodes to discover and join the cluster
# Default: 50001
APPROACH=50001

# CLUSTER - Fireflies membership CLUSTER port
# Used for inter-node membership gossip
# Default: 50002
CLUSTER=50002

# SERVICE - Internal service RPC port
# Used for internal node-to-node communication
# Default: 50003
SERVICE=50003

# HEALTH - HTTP health check endpoint port
# Used for monitoring and liveness probes
# Endpoint: http://<host>:<HEALTH>/health
# Default: 50004
HEALTH=50004

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

# DATA_DIR - Directory for persistent storage
# H2 database files stored here
# Default: /data (inside container)
# DATA_DIR='/data'

# DB_NAME - H2 database name
# Default: sky
# DB_NAME='sky'

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================

# LOG_LEVEL - Logging verbosity
# Values: TRACE, DEBUG, INFO, WARN, ERROR
# Default: INFO
# **Note**: INFO level includes token logging (see KNOWN_LIMITATIONS.md #32)
LOG_LEVEL='INFO'

# LOG_FILE - Log file path
# Default: /var/log/sky/app.log (inside container)
# LOG_FILE='/var/log/sky/app.log'

# ==============================================================================
# JVM CONFIGURATION
# ==============================================================================

# JAVA_OPTS - Additional JVM options
# Use for heap size, GC tuning, JMX, etc.
# Example: -Xmx4G -Xms2G -XX:+UseG1GC
# Default: (none - uses container defaults)
# JAVA_OPTS='-Xmx4G -Xms2G -XX:+UseG1GC -Djava.net.preferIPv4Stack=true'

# ==============================================================================
# SECURITY CONFIGURATION (Future/Production)
# ==============================================================================

# MTLS_CERT - Path to MTLS certificate
# Default: (generated ephemerally in POC)
# MTLS_CERT='/etc/sky/certs/node.crt'

# MTLS_KEY - Path to MTLS private key
# Default: (generated ephemerally in POC)
# MTLS_KEY='/etc/sky/certs/node.key'

# MTLS_CA - Path to certificate authority bundle
# Default: (self-signed in POC)
# MTLS_CA='/etc/sky/certs/ca.crt'

# ==============================================================================
# ADVANCED CONFIGURATION
# ==============================================================================

# SHAMIR_THRESHOLD - Shamir secret sharing threshold
# Number of shares required to reconstruct cluster secret
# Must be <= number of Genesis nodes
# Default: 3
# SHAMIR_THRESHOLD=3

# SHAMIR_SHARES - Total number of Shamir shares
# Must be >= SHAMIR_THRESHOLD
# Default: 5
# SHAMIR_SHARES=5

# FIREFLIES_GOSSIP_INTERVAL - Membership gossip interval (milliseconds)
# Lower values = faster failure detection, higher network overhead
# Default: 100
# FIREFLIES_GOSSIP_INTERVAL=100

# CHOAM_BATCH_SIZE - CHOAM consensus batch size (transactions per block)
# Higher values = better throughput, higher latency
# Default: 100
# CHOAM_BATCH_SIZE=100

# CHOAM_TIMEOUT - CHOAM leader timeout (milliseconds)
# Timeout before triggering view change (leader election)
# Default: 5000
# CHOAM_TIMEOUT=5000

# ==============================================================================
# EXAMPLE CONFIGURATIONS
# ==============================================================================

# --- Bootstrap Node (Genesis Kernel Member 1 of 4) ---
# GENESIS='true'
# BIND_INTERFACE='eth0'
# API=50000
# APPROACH=50001
# CLUSTER=50002
# SERVICE=50003
# HEALTH=50004
# (No APPROACHES or SEEDS - this is the first node)

# --- Kernel Node (Genesis Kernel Member 2-4 of 4) ---
# GENESIS='true'
# BIND_INTERFACE='eth0'
# APPROACHES='172.17.0.2:50001'
# SEEDS='172.17.0.2:50002#50000'
# HEALTH=50005  # Different port from bootstrap
# (API, APPROACH, CLUSTER, SERVICE use defaults)

# --- Joining Node (After Genesis) ---
# GENESIS='false'  # or omit
# BIND_INTERFACE='eth0'
# APPROACHES='172.17.0.2:50001,172.17.0.3:50001,172.17.0.4:50001'
# SEEDS='172.17.0.2:50002#50000,172.17.0.3:50002#50000'
# HEALTH=50010
# (Discovers cluster via multiple APPROACHES/SEEDS)

# ==============================================================================
# DOCKER COMPOSE USAGE
# ==============================================================================

# Option 1: Use environment section in compose.yaml
# services:
#   sky-node:
#     environment:
#       GENESIS: 'true'
#       BIND_INTERFACE: eth0
#       ...

# Option 2: Use env_file directive
# services:
#   sky-node:
#     env_file:
#       - .env

# Option 3: Use ${VARIABLE} substitution
# services:
#   sky-node:
#     environment:
#       GENESIS: '${GENESIS:-false}'
#       API: '${API:-50000}'
#       ...

# ==============================================================================
# KUBERNETES USAGE (Production)
# ==============================================================================

# Create ConfigMap:
# kubectl create configmap sky-config --from-env-file=.env

# Create Secret (for sensitive values):
# kubectl create secret generic sky-secrets \
#   --from-literal=mtls-cert="..." \
#   --from-literal=mtls-key="..."

# Reference in Deployment:
# envFrom:
#   - configMapRef:
#       name: sky-config
#   - secretRef:
#       name: sky-secrets

# ==============================================================================
# TROUBLESHOOTING
# ==============================================================================

# Issue: "Cannot bind to interface eth0"
# Solution: Check available interfaces with 'ip addr' or 'ifconfig'
#           Update BIND_INTERFACE to match

# Issue: "Cannot connect to bootstrap"
# Solution: Verify APPROACHES and SEEDS point to correct IPs and ports
#           Check firewall and network connectivity

# Issue: "Port already in use"
# Solution: Change port numbers (API, APPROACH, CLUSTER, SERVICE, HEALTH)
#           Ensure no conflicts with other services

# Issue: "Genesis block not committed"
# Solution: Ensure GENESIS='true' for exactly 4 nodes
#           Verify all 4 nodes are running and connected

# See TROUBLESHOOTING.md for detailed solutions

# ==============================================================================
# REFERENCES
# ==============================================================================

# Documentation:
# - README.md - Quick start and overview
# - DEMO_GUIDE.md - Step-by-step demo walkthrough
# - ARCHITECTURE.md - System architecture
# - KNOWN_LIMITATIONS.md - POC constraints
# - TROUBLESHOOTING.md - Common issues and solutions

# Ports Summary:
# 50000 - Oracle API (gRPC)
# 50001 - Fireflies APPROACH (TCP)
# 50002 - Fireflies CLUSTER (TCP)
# 50003 - Internal SERVICE (gRPC)
# 50004 - Health Check (HTTP)

# ==============================================================================
# NOTES
# ==============================================================================

# - This is a POC configuration. Production deployments need additional hardening.
# - Secrets (MTLS certs/keys) are generated ephemerally in POC.
# - Token logging at INFO level is acceptable for POC (see KNOWN_LIMITATIONS.md #32).
# - Adjust JVM heap (-Xmx) based on cluster size and workload.
# - For production, use external certificate management and secret rotation.

# EOF

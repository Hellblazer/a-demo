syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.hellblazer.nut.internal.v1.proto";
option java_outer_classname = "NutProto";
option objc_class_prefix = "Nut";
import "google/protobuf/empty.proto";

import "crypto.proto";
import "gorgoneion.proto";
import "sanctorum/v1/sanctorum.proto";

package com.hellblazer.nut.internal.v1;

service Sphinx {
  rpc apply(com.hellblazer.sanctorum.internal.v1.EncryptedShare) returns(com.hellblazer.sanctorum.internal.v1.Status) {}
  rpc unwrap(google.protobuf.Empty) returns(com.hellblazer.sanctorum.internal.v1.UnwrapStatus){}
  rpc seal(google.protobuf.Empty) returns(com.hellblazer.sanctorum.internal.v1.Status) {}
  rpc unseal(google.protobuf.Empty) returns(com.hellblazer.sanctorum.internal.v1.Status) {}
  rpc sessionKey(google.protobuf.Empty) returns(gorgoneion.PublicKey_) {}
  rpc identifier(google.protobuf.Empty) returns (crypto.Digeste) {}
}

service Provisioning {
  rpc provision(InitialProvisioning) returns (com.hellblazer.sanctorum.internal.v1.FernetToken) {}
}

message InitialProvisioning {
  // Shared Nonce for AED
  bytes nonce = 1;
  // namespace to use
  uint64 namespace = 2;
  // relationships to assert with the newly minted subject
  repeated uint64 relationships = 3;
  // relationship mappings to other subjects to assert with the newly minted subject
  map<uint64, uint64> mappings = 4;
  // relationship assertions to map to objects
  map<uint64, uint64> assertions = 5;
}
